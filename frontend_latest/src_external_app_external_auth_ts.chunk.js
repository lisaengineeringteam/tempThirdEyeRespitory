"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkhome_assistant_frontend"] = self["webpackChunkhome_assistant_frontend"] || []).push([["src_external_app_external_auth_ts"],{

/***/ "./src/external_app/external_auth.ts":
/*!*******************************************!*\
  !*** ./src/external_app/external_auth.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"ExternalAuth\": () => (/* binding */ ExternalAuth),\n/* harmony export */   \"createExternalAuth\": () => (/* binding */ createExternalAuth)\n/* harmony export */ });\n/* harmony import */ var home_assistant_js_websocket__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! home-assistant-js-websocket */ \"./node_modules/home-assistant-js-websocket/dist/auth.js\");\n/* harmony import */ var _external_messaging__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./external_messaging */ \"./src/external_app/external_messaging.ts\");\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/**\n * Auth class that connects to a native app for authentication.\n */\n\n\nconst CALLBACK_SET_TOKEN = \"externalAuthSetToken\";\nconst CALLBACK_REVOKE_TOKEN = \"externalAuthRevokeToken\";\n\nif (!window.externalApp && !window.webkit) {\n  throw new Error(\"External auth requires either externalApp or webkit defined on Window object.\");\n}\n\nclass ExternalAuth extends home_assistant_js_websocket__WEBPACK_IMPORTED_MODULE_1__.Auth {\n  constructor(hassUrl) {\n    super({\n      hassUrl,\n      clientId: \"\",\n      refresh_token: \"\",\n      access_token: \"\",\n      expires_in: 0,\n      // This will trigger connection to do a refresh right away\n      expires: 0\n    });\n\n    _defineProperty(this, \"external\", void 0);\n\n    _defineProperty(this, \"_tokenCallbackPromise\", void 0);\n  }\n\n  async refreshAccessToken(force) {\n    if (this._tokenCallbackPromise && !force) {\n      try {\n        await this._tokenCallbackPromise;\n        return;\n      } catch (err) {\n        // _tokenCallbackPromise is in a rejected state\n        // Clear the _tokenCallbackPromise and go on refreshing access token\n        this._tokenCallbackPromise = undefined;\n      }\n    }\n\n    const payload = {\n      callback: CALLBACK_SET_TOKEN\n    };\n\n    if (force) {\n      payload.force = true;\n    }\n\n    this._tokenCallbackPromise = new Promise((resolve, reject) => {\n      window[CALLBACK_SET_TOKEN] = (success, data) => success ? resolve(data) : reject(data);\n    }); // we sleep 1 microtask to get the promise to actually set it on the window object.\n\n    await Promise.resolve();\n\n    if (window.externalApp) {\n      window.externalApp.getExternalAuth(JSON.stringify(payload));\n    } else {\n      window.webkit.messageHandlers.getExternalAuth.postMessage(payload);\n    }\n\n    const tokens = await this._tokenCallbackPromise;\n    this.data.access_token = tokens.access_token;\n    this.data.expires = tokens.expires_in * 1000 + Date.now();\n    this._tokenCallbackPromise = undefined;\n  }\n\n  async revoke() {\n    const payload = {\n      callback: CALLBACK_REVOKE_TOKEN\n    };\n    const callbackPromise = new Promise((resolve, reject) => {\n      window[CALLBACK_REVOKE_TOKEN] = (success, data) => success ? resolve(data) : reject(data);\n    }); // we sleep 1 microtask to get the promise to actually set it on the window object.\n\n    await Promise.resolve();\n\n    if (window.externalApp) {\n      window.externalApp.revokeExternalAuth(JSON.stringify(payload));\n    } else {\n      window.webkit.messageHandlers.revokeExternalAuth.postMessage(payload);\n    }\n\n    await callbackPromise;\n  }\n\n}\nconst createExternalAuth = async hassUrl => {\n  const auth = new ExternalAuth(hassUrl);\n\n  if (window.externalApp && window.externalApp.externalBus || window.webkit && window.webkit.messageHandlers.externalBus) {\n    auth.external = new _external_messaging__WEBPACK_IMPORTED_MODULE_0__.ExternalMessaging();\n    await auth.external.attach();\n  }\n\n  return auth;\n};//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZXh0ZXJuYWxfYXBwL2V4dGVybmFsX2F1dGgudHMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBc0NBO0FBQ0E7QUFHQTs7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBOztBQURBOztBQUFBO0FBVUE7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBREE7O0FBR0E7QUFDQTtBQUNBOztBQUVBO0FBRUE7QUFFQTs7QUFJQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBRUE7O0FBR0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQTVFQTtBQStFQTtBQUNBOztBQUNBO0FBSUE7QUFDQTtBQUNBOztBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ob21lLWFzc2lzdGFudC1mcm9udGVuZC8uL3NyYy9leHRlcm5hbF9hcHAvZXh0ZXJuYWxfYXV0aC50cz81MjhhIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQXV0aCBjbGFzcyB0aGF0IGNvbm5lY3RzIHRvIGEgbmF0aXZlIGFwcCBmb3IgYXV0aGVudGljYXRpb24uXG4gKi9cbmltcG9ydCB7IEF1dGggfSBmcm9tIFwiaG9tZS1hc3Npc3RhbnQtanMtd2Vic29ja2V0XCI7XG5pbXBvcnQgeyBFeHRlcm5hbE1lc3NhZ2luZywgRU1NZXNzYWdlIH0gZnJvbSBcIi4vZXh0ZXJuYWxfbWVzc2FnaW5nXCI7XG5cbmNvbnN0IENBTExCQUNLX1NFVF9UT0tFTiA9IFwiZXh0ZXJuYWxBdXRoU2V0VG9rZW5cIjtcbmNvbnN0IENBTExCQUNLX1JFVk9LRV9UT0tFTiA9IFwiZXh0ZXJuYWxBdXRoUmV2b2tlVG9rZW5cIjtcblxuaW50ZXJmYWNlIEJhc2VQYXlsb2FkIHtcbiAgY2FsbGJhY2s6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIEdldEV4dGVybmFsQXV0aFBheWxvYWQgZXh0ZW5kcyBCYXNlUGF5bG9hZCB7XG4gIGZvcmNlPzogYm9vbGVhbjtcbn1cblxuaW50ZXJmYWNlIFJlZnJlc2hUb2tlblJlc3BvbnNlIHtcbiAgYWNjZXNzX3Rva2VuOiBzdHJpbmc7XG4gIGV4cGlyZXNfaW46IG51bWJlcjtcbn1cblxuZGVjbGFyZSBnbG9iYWwge1xuICBpbnRlcmZhY2UgV2luZG93IHtcbiAgICBleHRlcm5hbEFwcD86IHtcbiAgICAgIGdldEV4dGVybmFsQXV0aChwYXlsb2FkOiBzdHJpbmcpO1xuICAgICAgcmV2b2tlRXh0ZXJuYWxBdXRoKHBheWxvYWQ6IHN0cmluZyk7XG4gICAgICBleHRlcm5hbEJ1cyhwYXlsb2FkOiBzdHJpbmcpO1xuICAgIH07XG4gICAgd2Via2l0Pzoge1xuICAgICAgbWVzc2FnZUhhbmRsZXJzOiB7XG4gICAgICAgIGdldEV4dGVybmFsQXV0aDoge1xuICAgICAgICAgIHBvc3RNZXNzYWdlKHBheWxvYWQ6IEdldEV4dGVybmFsQXV0aFBheWxvYWQpO1xuICAgICAgICB9O1xuICAgICAgICByZXZva2VFeHRlcm5hbEF1dGg6IHtcbiAgICAgICAgICBwb3N0TWVzc2FnZShwYXlsb2FkOiBCYXNlUGF5bG9hZCk7XG4gICAgICAgIH07XG4gICAgICAgIGV4dGVybmFsQnVzOiB7XG4gICAgICAgICAgcG9zdE1lc3NhZ2UocGF5bG9hZDogRU1NZXNzYWdlKTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfTtcbiAgfVxufVxuXG5pZiAoIXdpbmRvdy5leHRlcm5hbEFwcCAmJiAhd2luZG93LndlYmtpdCkge1xuICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgXCJFeHRlcm5hbCBhdXRoIHJlcXVpcmVzIGVpdGhlciBleHRlcm5hbEFwcCBvciB3ZWJraXQgZGVmaW5lZCBvbiBXaW5kb3cgb2JqZWN0LlwiXG4gICk7XG59XG5cbmV4cG9ydCBjbGFzcyBFeHRlcm5hbEF1dGggZXh0ZW5kcyBBdXRoIHtcbiAgcHVibGljIGV4dGVybmFsPzogRXh0ZXJuYWxNZXNzYWdpbmc7XG5cbiAgY29uc3RydWN0b3IoaGFzc1VybDogc3RyaW5nKSB7XG4gICAgc3VwZXIoe1xuICAgICAgaGFzc1VybCxcbiAgICAgIGNsaWVudElkOiBcIlwiLFxuICAgICAgcmVmcmVzaF90b2tlbjogXCJcIixcbiAgICAgIGFjY2Vzc190b2tlbjogXCJcIixcbiAgICAgIGV4cGlyZXNfaW46IDAsXG4gICAgICAvLyBUaGlzIHdpbGwgdHJpZ2dlciBjb25uZWN0aW9uIHRvIGRvIGEgcmVmcmVzaCByaWdodCBhd2F5XG4gICAgICBleHBpcmVzOiAwLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBfdG9rZW5DYWxsYmFja1Byb21pc2U/OiBQcm9taXNlPFJlZnJlc2hUb2tlblJlc3BvbnNlPjtcblxuICBwdWJsaWMgYXN5bmMgcmVmcmVzaEFjY2Vzc1Rva2VuKGZvcmNlPzogYm9vbGVhbikge1xuICAgIGlmICh0aGlzLl90b2tlbkNhbGxiYWNrUHJvbWlzZSAmJiAhZm9yY2UpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMuX3Rva2VuQ2FsbGJhY2tQcm9taXNlO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgICAgICAvLyBfdG9rZW5DYWxsYmFja1Byb21pc2UgaXMgaW4gYSByZWplY3RlZCBzdGF0ZVxuICAgICAgICAvLyBDbGVhciB0aGUgX3Rva2VuQ2FsbGJhY2tQcm9taXNlIGFuZCBnbyBvbiByZWZyZXNoaW5nIGFjY2VzcyB0b2tlblxuICAgICAgICB0aGlzLl90b2tlbkNhbGxiYWNrUHJvbWlzZSA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgcGF5bG9hZDogR2V0RXh0ZXJuYWxBdXRoUGF5bG9hZCA9IHtcbiAgICAgIGNhbGxiYWNrOiBDQUxMQkFDS19TRVRfVE9LRU4sXG4gICAgfTtcbiAgICBpZiAoZm9yY2UpIHtcbiAgICAgIHBheWxvYWQuZm9yY2UgPSB0cnVlO1xuICAgIH1cblxuICAgIHRoaXMuX3Rva2VuQ2FsbGJhY2tQcm9taXNlID0gbmV3IFByb21pc2U8UmVmcmVzaFRva2VuUmVzcG9uc2U+KFxuICAgICAgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICB3aW5kb3dbQ0FMTEJBQ0tfU0VUX1RPS0VOXSA9IChzdWNjZXNzLCBkYXRhKSA9PlxuICAgICAgICAgIHN1Y2Nlc3MgPyByZXNvbHZlKGRhdGEpIDogcmVqZWN0KGRhdGEpO1xuICAgICAgfVxuICAgICk7XG5cbiAgICAvLyB3ZSBzbGVlcCAxIG1pY3JvdGFzayB0byBnZXQgdGhlIHByb21pc2UgdG8gYWN0dWFsbHkgc2V0IGl0IG9uIHRoZSB3aW5kb3cgb2JqZWN0LlxuICAgIGF3YWl0IFByb21pc2UucmVzb2x2ZSgpO1xuXG4gICAgaWYgKHdpbmRvdy5leHRlcm5hbEFwcCkge1xuICAgICAgd2luZG93LmV4dGVybmFsQXBwLmdldEV4dGVybmFsQXV0aChKU09OLnN0cmluZ2lmeShwYXlsb2FkKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHdpbmRvdy53ZWJraXQhLm1lc3NhZ2VIYW5kbGVycy5nZXRFeHRlcm5hbEF1dGgucG9zdE1lc3NhZ2UocGF5bG9hZCk7XG4gICAgfVxuXG4gICAgY29uc3QgdG9rZW5zID0gYXdhaXQgdGhpcy5fdG9rZW5DYWxsYmFja1Byb21pc2U7XG5cbiAgICB0aGlzLmRhdGEuYWNjZXNzX3Rva2VuID0gdG9rZW5zLmFjY2Vzc190b2tlbjtcbiAgICB0aGlzLmRhdGEuZXhwaXJlcyA9IHRva2Vucy5leHBpcmVzX2luICogMTAwMCArIERhdGUubm93KCk7XG4gICAgdGhpcy5fdG9rZW5DYWxsYmFja1Byb21pc2UgPSB1bmRlZmluZWQ7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgcmV2b2tlKCkge1xuICAgIGNvbnN0IHBheWxvYWQ6IEJhc2VQYXlsb2FkID0geyBjYWxsYmFjazogQ0FMTEJBQ0tfUkVWT0tFX1RPS0VOIH07XG5cbiAgICBjb25zdCBjYWxsYmFja1Byb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB3aW5kb3dbQ0FMTEJBQ0tfUkVWT0tFX1RPS0VOXSA9IChzdWNjZXNzLCBkYXRhKSA9PlxuICAgICAgICBzdWNjZXNzID8gcmVzb2x2ZShkYXRhKSA6IHJlamVjdChkYXRhKTtcbiAgICB9KTtcblxuICAgIC8vIHdlIHNsZWVwIDEgbWljcm90YXNrIHRvIGdldCB0aGUgcHJvbWlzZSB0byBhY3R1YWxseSBzZXQgaXQgb24gdGhlIHdpbmRvdyBvYmplY3QuXG4gICAgYXdhaXQgUHJvbWlzZS5yZXNvbHZlKCk7XG5cbiAgICBpZiAod2luZG93LmV4dGVybmFsQXBwKSB7XG4gICAgICB3aW5kb3cuZXh0ZXJuYWxBcHAucmV2b2tlRXh0ZXJuYWxBdXRoKEpTT04uc3RyaW5naWZ5KHBheWxvYWQpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgd2luZG93LndlYmtpdCEubWVzc2FnZUhhbmRsZXJzLnJldm9rZUV4dGVybmFsQXV0aC5wb3N0TWVzc2FnZShwYXlsb2FkKTtcbiAgICB9XG5cbiAgICBhd2FpdCBjYWxsYmFja1Byb21pc2U7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUV4dGVybmFsQXV0aCA9IGFzeW5jIChoYXNzVXJsOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgYXV0aCA9IG5ldyBFeHRlcm5hbEF1dGgoaGFzc1VybCk7XG4gIGlmIChcbiAgICAod2luZG93LmV4dGVybmFsQXBwICYmIHdpbmRvdy5leHRlcm5hbEFwcC5leHRlcm5hbEJ1cykgfHxcbiAgICAod2luZG93LndlYmtpdCAmJiB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5leHRlcm5hbEJ1cylcbiAgKSB7XG4gICAgYXV0aC5leHRlcm5hbCA9IG5ldyBFeHRlcm5hbE1lc3NhZ2luZygpO1xuICAgIGF3YWl0IGF1dGguZXh0ZXJuYWwuYXR0YWNoKCk7XG4gIH1cbiAgcmV0dXJuIGF1dGg7XG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/external_app/external_auth.ts\n");

/***/ }),

/***/ "./src/external_app/external_messaging.ts":
/*!************************************************!*\
  !*** ./src/external_app/external_messaging.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"ExternalMessaging\": () => (/* binding */ ExternalMessaging)\n/* harmony export */ });\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nconst CALLBACK_EXTERNAL_BUS = \"externalBus\";\nclass ExternalMessaging {\n  constructor() {\n    _defineProperty(this, \"config\", void 0);\n\n    _defineProperty(this, \"commands\", {});\n\n    _defineProperty(this, \"msgId\", 0);\n\n    _defineProperty(this, \"_commandHandler\", void 0);\n  }\n\n  async attach() {\n    window[CALLBACK_EXTERNAL_BUS] = msg => this.receiveMessage(msg);\n\n    window.addEventListener(\"connection-status\", ev => this.fireMessage({\n      type: \"connection-status\",\n      payload: {\n        event: ev.detail\n      }\n    }));\n    this.config = await this.sendMessage({\n      type: \"config/get\"\n    });\n  }\n\n  addCommandHandler(handler) {\n    this._commandHandler = handler;\n  }\n  /**\n   * Send message to external app that expects a response.\n   * @param msg message to send\n   */\n\n\n  sendMessage(msg) {\n    const msgId = ++this.msgId;\n    msg.id = msgId;\n    this.fireMessage(msg);\n    return new Promise((resolve, reject) => {\n      this.commands[msgId] = {\n        resolve,\n        reject\n      };\n    });\n  }\n  /**\n   * Send message to external app without expecting a response.\n   * @param msg message to send\n   */\n\n\n  fireMessage(msg) {\n    if (!msg.id) {\n      msg.id = ++this.msgId;\n    }\n\n    this._sendExternal(msg);\n  }\n\n  receiveMessage(msg) {\n    if (true) {\n      // eslint-disable-next-line no-console\n      console.log(\"Receiving message from external app\", msg);\n    }\n\n    if (msg.type === \"command\") {\n      if (!this._commandHandler || !this._commandHandler(msg)) {\n        let code;\n        let message;\n\n        if (this._commandHandler) {\n          code = \"not_ready\";\n          message = \"Command handler not ready\";\n        } else {\n          code = \"unknown_command\";\n          message = `Unknown command ${msg.command}`;\n        } // eslint-disable-next-line no-console\n\n\n        console.warn(message, msg);\n        this.fireMessage({\n          id: msg.id,\n          type: \"result\",\n          success: false,\n          error: {\n            code,\n            message\n          }\n        });\n      }\n\n      return;\n    }\n\n    const pendingCmd = this.commands[msg.id];\n\n    if (!pendingCmd) {\n      // eslint-disable-next-line no-console\n      console.warn(`Received unknown msg ID`, msg.id);\n      return;\n    }\n\n    if (msg.type === \"result\") {\n      if (msg.success) {\n        pendingCmd.resolve(msg.result);\n      } else {\n        pendingCmd.reject(msg.error);\n      }\n    }\n  }\n\n  _sendExternal(msg) {\n    if (true) {\n      // eslint-disable-next-line no-console\n      console.log(\"Sending message to external app\", msg);\n    }\n\n    if (window.externalApp) {\n      window.externalApp.externalBus(JSON.stringify(msg));\n    } else {\n      window.webkit.messageHandlers.externalBus.postMessage(msg);\n    }\n  }\n\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZXh0ZXJuYWxfYXBwL2V4dGVybmFsX21lc3NhZ2luZy50cy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQThEQTtBQUFBO0FBQUE7O0FBQUE7O0FBQUE7O0FBQUE7QUFBQTs7QUFTQTtBQUNBOztBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFGQTtBQUtBO0FBQ0E7QUFEQTtBQUdBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBR0E7QUFDQTtBQUNBOztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSkE7QUFTQTs7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFqSEEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ob21lLWFzc2lzdGFudC1mcm9udGVuZC8uL3NyYy9leHRlcm5hbF9hcHAvZXh0ZXJuYWxfbWVzc2FnaW5nLnRzPzM5MmQiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgQ0FMTEJBQ0tfRVhURVJOQUxfQlVTID0gXCJleHRlcm5hbEJ1c1wiO1xuXG5pbnRlcmZhY2UgQ29tbWFuZEluRmxpZ2h0IHtcbiAgcmVzb2x2ZTogKGRhdGE6IGFueSkgPT4gdm9pZDtcbiAgcmVqZWN0OiAoZXJyOiBFTUVycm9yKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEVNTWVzc2FnZSB7XG4gIGlkPzogbnVtYmVyO1xuICB0eXBlOiBzdHJpbmc7XG4gIHBheWxvYWQ/OiB1bmtub3duO1xufVxuXG5pbnRlcmZhY2UgRU1FcnJvciB7XG4gIGNvZGU6IHN0cmluZztcbiAgbWVzc2FnZTogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgRU1NZXNzYWdlUmVzdWx0U3VjY2VzcyB7XG4gIGlkOiBudW1iZXI7XG4gIHR5cGU6IFwicmVzdWx0XCI7XG4gIHN1Y2Nlc3M6IHRydWU7XG4gIHJlc3VsdDogdW5rbm93bjtcbn1cblxuaW50ZXJmYWNlIEVNTWVzc2FnZVJlc3VsdEVycm9yIHtcbiAgaWQ6IG51bWJlcjtcbiAgdHlwZTogXCJyZXN1bHRcIjtcbiAgc3VjY2VzczogZmFsc2U7XG4gIGVycm9yOiBFTUVycm9yO1xufVxuXG5pbnRlcmZhY2UgRU1FeHRlcm5hbE1lc3NhZ2VSZXN0YXJ0IHtcbiAgaWQ6IG51bWJlcjtcbiAgdHlwZTogXCJjb21tYW5kXCI7XG4gIGNvbW1hbmQ6IFwicmVzdGFydFwiO1xufVxuXG5pbnRlcmZhY2UgRU1FeHRlcm5NZXNzYWdlU2hvd05vdGlmaWNhdGlvbnMge1xuICBpZDogbnVtYmVyO1xuICB0eXBlOiBcImNvbW1hbmRcIjtcbiAgY29tbWFuZDogXCJub3RpZmljYXRpb25zL3Nob3dcIjtcbn1cblxuZXhwb3J0IHR5cGUgRU1FeHRlcm5hbE1lc3NhZ2VDb21tYW5kcyA9XG4gIHwgRU1FeHRlcm5hbE1lc3NhZ2VSZXN0YXJ0XG4gIHwgRU1FeHRlcm5NZXNzYWdlU2hvd05vdGlmaWNhdGlvbnM7XG5cbnR5cGUgRXh0ZXJuYWxNZXNzYWdlID1cbiAgfCBFTU1lc3NhZ2VSZXN1bHRTdWNjZXNzXG4gIHwgRU1NZXNzYWdlUmVzdWx0RXJyb3JcbiAgfCBFTUV4dGVybmFsTWVzc2FnZUNvbW1hbmRzO1xuXG50eXBlIEV4dGVybmFsTWVzc2FnZUhhbmRsZXIgPSAobXNnOiBFTUV4dGVybmFsTWVzc2FnZUNvbW1hbmRzKSA9PiBib29sZWFuO1xuXG5leHBvcnQgaW50ZXJmYWNlIEV4dGVybmFsQ29uZmlnIHtcbiAgaGFzU2V0dGluZ3NTY3JlZW46IGJvb2xlYW47XG4gIGhhc1NpZGViYXI6IGJvb2xlYW47XG4gIGNhbldyaXRlVGFnOiBib29sZWFuO1xuICBoYXNFeG9QbGF5ZXI6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBFeHRlcm5hbE1lc3NhZ2luZyB7XG4gIHB1YmxpYyBjb25maWchOiBFeHRlcm5hbENvbmZpZztcblxuICBwdWJsaWMgY29tbWFuZHM6IHsgW21zZ0lkOiBudW1iZXJdOiBDb21tYW5kSW5GbGlnaHQgfSA9IHt9O1xuXG4gIHB1YmxpYyBtc2dJZCA9IDA7XG5cbiAgcHJpdmF0ZSBfY29tbWFuZEhhbmRsZXI/OiBFeHRlcm5hbE1lc3NhZ2VIYW5kbGVyO1xuXG4gIHB1YmxpYyBhc3luYyBhdHRhY2goKSB7XG4gICAgd2luZG93W0NBTExCQUNLX0VYVEVSTkFMX0JVU10gPSAobXNnKSA9PiB0aGlzLnJlY2VpdmVNZXNzYWdlKG1zZyk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJjb25uZWN0aW9uLXN0YXR1c1wiLCAoZXYpID0+XG4gICAgICB0aGlzLmZpcmVNZXNzYWdlKHtcbiAgICAgICAgdHlwZTogXCJjb25uZWN0aW9uLXN0YXR1c1wiLFxuICAgICAgICBwYXlsb2FkOiB7IGV2ZW50OiBldi5kZXRhaWwgfSxcbiAgICAgIH0pXG4gICAgKTtcbiAgICB0aGlzLmNvbmZpZyA9IGF3YWl0IHRoaXMuc2VuZE1lc3NhZ2U8RXh0ZXJuYWxDb25maWc+KHtcbiAgICAgIHR5cGU6IFwiY29uZmlnL2dldFwiLFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGFkZENvbW1hbmRIYW5kbGVyKGhhbmRsZXI6IEV4dGVybmFsTWVzc2FnZUhhbmRsZXIpIHtcbiAgICB0aGlzLl9jb21tYW5kSGFuZGxlciA9IGhhbmRsZXI7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBtZXNzYWdlIHRvIGV4dGVybmFsIGFwcCB0aGF0IGV4cGVjdHMgYSByZXNwb25zZS5cbiAgICogQHBhcmFtIG1zZyBtZXNzYWdlIHRvIHNlbmRcbiAgICovXG4gIHB1YmxpYyBzZW5kTWVzc2FnZTxUPihtc2c6IEVNTWVzc2FnZSk6IFByb21pc2U8VD4ge1xuICAgIGNvbnN0IG1zZ0lkID0gKyt0aGlzLm1zZ0lkO1xuICAgIG1zZy5pZCA9IG1zZ0lkO1xuXG4gICAgdGhpcy5maXJlTWVzc2FnZShtc2cpO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPFQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuY29tbWFuZHNbbXNnSWRdID0geyByZXNvbHZlLCByZWplY3QgfTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIG1lc3NhZ2UgdG8gZXh0ZXJuYWwgYXBwIHdpdGhvdXQgZXhwZWN0aW5nIGEgcmVzcG9uc2UuXG4gICAqIEBwYXJhbSBtc2cgbWVzc2FnZSB0byBzZW5kXG4gICAqL1xuICBwdWJsaWMgZmlyZU1lc3NhZ2UoXG4gICAgbXNnOiBFTU1lc3NhZ2UgfCBFTU1lc3NhZ2VSZXN1bHRTdWNjZXNzIHwgRU1NZXNzYWdlUmVzdWx0RXJyb3JcbiAgKSB7XG4gICAgaWYgKCFtc2cuaWQpIHtcbiAgICAgIG1zZy5pZCA9ICsrdGhpcy5tc2dJZDtcbiAgICB9XG4gICAgdGhpcy5fc2VuZEV4dGVybmFsKG1zZyk7XG4gIH1cblxuICBwdWJsaWMgcmVjZWl2ZU1lc3NhZ2UobXNnOiBFeHRlcm5hbE1lc3NhZ2UpIHtcbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICAgIGNvbnNvbGUubG9nKFwiUmVjZWl2aW5nIG1lc3NhZ2UgZnJvbSBleHRlcm5hbCBhcHBcIiwgbXNnKTtcbiAgICB9XG5cbiAgICBpZiAobXNnLnR5cGUgPT09IFwiY29tbWFuZFwiKSB7XG4gICAgICBpZiAoIXRoaXMuX2NvbW1hbmRIYW5kbGVyIHx8ICF0aGlzLl9jb21tYW5kSGFuZGxlcihtc2cpKSB7XG4gICAgICAgIGxldCBjb2RlOiBzdHJpbmc7XG4gICAgICAgIGxldCBtZXNzYWdlOiBzdHJpbmc7XG4gICAgICAgIGlmICh0aGlzLl9jb21tYW5kSGFuZGxlcikge1xuICAgICAgICAgIGNvZGUgPSBcIm5vdF9yZWFkeVwiO1xuICAgICAgICAgIG1lc3NhZ2UgPSBcIkNvbW1hbmQgaGFuZGxlciBub3QgcmVhZHlcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb2RlID0gXCJ1bmtub3duX2NvbW1hbmRcIjtcbiAgICAgICAgICBtZXNzYWdlID0gYFVua25vd24gY29tbWFuZCAke21zZy5jb21tYW5kfWA7XG4gICAgICAgIH1cbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICAgICAgY29uc29sZS53YXJuKG1lc3NhZ2UsIG1zZyk7XG4gICAgICAgIHRoaXMuZmlyZU1lc3NhZ2Uoe1xuICAgICAgICAgIGlkOiBtc2cuaWQsXG4gICAgICAgICAgdHlwZTogXCJyZXN1bHRcIixcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgY29kZSxcbiAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcGVuZGluZ0NtZCA9IHRoaXMuY29tbWFuZHNbbXNnLmlkXTtcblxuICAgIGlmICghcGVuZGluZ0NtZCkge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICAgIGNvbnNvbGUud2FybihgUmVjZWl2ZWQgdW5rbm93biBtc2cgSURgLCBtc2cuaWQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChtc2cudHlwZSA9PT0gXCJyZXN1bHRcIikge1xuICAgICAgaWYgKG1zZy5zdWNjZXNzKSB7XG4gICAgICAgIHBlbmRpbmdDbWQucmVzb2x2ZShtc2cucmVzdWx0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBlbmRpbmdDbWQucmVqZWN0KG1zZy5lcnJvcik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIF9zZW5kRXh0ZXJuYWwobXNnOiBFTU1lc3NhZ2UpIHtcbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICAgIGNvbnNvbGUubG9nKFwiU2VuZGluZyBtZXNzYWdlIHRvIGV4dGVybmFsIGFwcFwiLCBtc2cpO1xuICAgIH1cbiAgICBpZiAod2luZG93LmV4dGVybmFsQXBwKSB7XG4gICAgICB3aW5kb3cuZXh0ZXJuYWxBcHAuZXh0ZXJuYWxCdXMoSlNPTi5zdHJpbmdpZnkobXNnKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHdpbmRvdy53ZWJraXQhLm1lc3NhZ2VIYW5kbGVycy5leHRlcm5hbEJ1cy5wb3N0TWVzc2FnZShtc2cpO1xuICAgIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/external_app/external_messaging.ts\n");

/***/ })

}]);